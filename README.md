# semantic-release-bundle
A package designed to replace package versions in JavaScript bundles.

[![Version][badge-vers]][npm]
[![Bundle size][npm-size-badge]][npm-size-url]
[![Downloads][npm-downloads-badge]][npm]

[![CodeFactor][codefactor-badge]][codefactor-url]
[![SonarCloud][sonarcloud-badge]][sonarcloud-url]
[![Codacy][codacy-badge]][codacy-url]
[![Scrutinizer][scrutinizer-badge]][scrutinizer-url]

[![Dependencies][badge-deps]][npm]
[![Security][snyk-badge]][snyk-url]
[![Build Status][tests-badge]][tests-url]
[![Coverage Status][badge-coverage]][url-coverage]

[![Commit activity][commit-activity-badge]][github]
[![FOSSA][fossa-badge]][fossa-url]
[![License][badge-lic]][github]
[![Made in Ukraine][ukr-badge]][ukr-link]


## Table of Contents
- [semantic-release-bundle](#semantic-release-bundle)
  - [Table of Contents](#table-of-contents)
  - [Motivation](#motivation)
  - [Requirements](#requirements)
  - [Installation](#installation)
  - [Usage](#usage)
    - [Configuration](#configuration)
    - [Preconditions](#preconditions)
  - [How it works](#how-it-works)
  - [Contribute](#contribute)

## Motivation

Sometimes, using a universal [semantic-release][sr-url] plugin like `@google/semantic-release-replace-plugin` or `@semantic-release/exec` suffices to update versions in arbitrary files. However, for UI bundles, this task becomes challenging. This package provides strategies for comfortable version management, specifically tailored to JS bundles.

## Requirements
[![Platform Status][node-ver-test-badge]][node-ver-test-url]

To use library you need to have [node](https://nodejs.org) and [npm](https://www.npmjs.com) installed in your machine:

* node `>=10`
* npm `>=6`

Package is [continuously tested][node-ver-test-url] on darwin, linux and win32 platforms. All active and maintenance [LTS](https://nodejs.org/en/about/releases/) node releases are supported.

## Installation

To install the library run the following command

```bash
  npm i --save-dev semantic-release-bundle
```

## Usage

Configure the plugin in the semantic-release [configuration file][sr-config]:

```json
{
  "plugins": [
    "@semantic-release/commit-analyzer",
    "@semantic-release/release-notes-generator",
    [
      "semantic-release-bundle",
      {
        "type": "q-manifest"
      }
    ]
  ]
}
```

### Configuration

Customizable options include:
  * `type`: Strategy to use, currently only supports 'q-manifest'
  * `packageJSONPath`: Specify the path to the package.json file (default is 'package.json')
  * `directory`: Bundle directory (default is 'dist')
  * `updatePackageJSON`: Update version in package.json file

Strategy-related options:
  * `buildDirectory`: For 'q-manifest', specifies the build directory ('build' by default)

### Preconditions

Before using the package, ensure the following assumptions work for your project:

  1. package.json stores the old (unchanged) version during the verifyconditions step.
  2. Bundle (with the unchanged version) is already generated at the moment of the verifyconditions step.
  3. Version change should occur during the prepare step.

## How it works

The package scans the bundle for the previous version, which is obtained from package.json. It then replaces all occurrences of the matched pattern with the new version.
q-manifest

**q-manifest** is a strategy suitable for bundles generated by the [qwik framework][qwik]. Look for a sample in [tests/bundles/tastoria][bundle-sample] folder. semantic-release-bundle only modifies parts that import the package.json file because it observes the q-manifest file.

If you use [Vite][vite]/[Rollup][rollup] for bundle generation but not the qwik framework, you can generate a similar q-manifest.json file and utilize this strategy.

[sr-url]: https://github.com/semantic-release/semantic-release
[sr-config]: https://github.com/semantic-release/semantic-release/blob/master/docs/usage/configuration.md#configuration
[bundle-sample]: ./tests/bundles/tastoria_1.2.1
[qwik]: https://qwik.builder.io/
[vite]: https://vitejs.dev/
[rollup]: https://rollupjs.org/

## Contribute

Make the changes to the code and tests. Then commit to your branch. Be sure to follow the commit message conventions. Read [Contributing Guidelines](.github/CONTRIBUTING.md) for details.

[npm]: https://www.npmjs.com/package/semantic-release-bundle
[github]: https://github.com/pustovitDmytro/semantic-release-bundle
[coveralls]: https://coveralls.io/github/pustovitDmytro/semantic-release-bundle?branch=master
[badge-deps]: https://img.shields.io/librariesio/release/npm/semantic-release-bundle.svg
[badge-vers]: https://img.shields.io/npm/v/semantic-release-bundle.svg
[badge-lic]: https://img.shields.io/github/license/pustovitDmytro/semantic-release-bundle.svg
[badge-coverage]: https://coveralls.io/repos/github/pustovitDmytro/semantic-release-bundle/badge.svg?branch=master
[url-coverage]: https://coveralls.io/github/pustovitDmytro/semantic-release-bundle?branch=master

[snyk-badge]: https://snyk-widget.herokuapp.com/badge/npm/semantic-release-bundle/badge.svg
[snyk-url]: https://snyk.io/advisor/npm-package/semantic-release-bundle

[tests-badge]: https://img.shields.io/circleci/build/github/pustovitDmytro/semantic-release-bundle
[tests-url]: https://app.circleci.com/pipelines/github/pustovitDmytro/semantic-release-bundle

[codefactor-badge]: https://www.codefactor.io/repository/github/pustovitdmytro/semantic-release-bundle/badge
[codefactor-url]: https://www.codefactor.io/repository/github/pustovitdmytro/semantic-release-bundle

[commit-activity-badge]: https://img.shields.io/github/commit-activity/m/pustovitDmytro/semantic-release-bundle

[scrutinizer-badge]: https://scrutinizer-ci.com/g/pustovitDmytro/semantic-release-bundle/badges/quality-score.png?b=master
[scrutinizer-url]: https://scrutinizer-ci.com/g/pustovitDmytro/semantic-release-bundle/?branch=master

[codacy-badge]: https://app.codacy.com/project/badge/Grade/8667aa23afaa4725854f098c4b5e8890
[codacy-url]: https://www.codacy.com/gh/pustovitDmytro/semantic-release-bundle/dashboard?utm_source=github.com&amp;utm_medium=referral&amp;utm_content=pustovitDmytro/semantic-release-bundle&amp;utm_campaign=Badge_Grade

[sonarcloud-badge]: https://sonarcloud.io/api/project_badges/measure?project=pustovitDmytro_semantic-release-bundle&metric=alert_status
[sonarcloud-url]: https://sonarcloud.io/dashboard?id=pustovitDmytro_semantic-release-bundle

[npm-downloads-badge]: https://img.shields.io/npm/dw/semantic-release-bundle
[npm-size-badge]: https://img.shields.io/bundlephobia/min/semantic-release-bundle
[npm-size-url]: https://bundlephobia.com/result?p=semantic-release-bundle

[node-ver-test-badge]: https://github.com/pustovitDmytro/semantic-release-bundle/actions/workflows/npt.yml/badge.svg?branch=master
[node-ver-test-url]: https://github.com/pustovitDmytro/semantic-release-bundle/actions?query=workflow%3A%22Node.js+versions%22

[fossa-badge]: https://app.fossa.com/api/projects/custom%2B24828%2Fsemantic-release-bundle.svg?type=shield
[fossa-url]: https://app.fossa.com/projects/custom%2B24828%2Fsemantic-release-bundle?ref=badge_shield

[ukr-badge]: https://img.shields.io/badge/made_in-ukraine-ffd700.svg?labelColor=0057b7
[ukr-link]: https://war.ukraine.ua